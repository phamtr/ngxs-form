{
  "version": 3,
  "file": "directive.js",
  "sources": [
    "ng://@ngxs/form-plugin/packages/form-plugin/src/directive.ts"
  ],
  "sourcesContent": [
    "import { Directive, Input, OnInit, OnDestroy, ChangeDetectorRef } from '@angular/core';\nimport { FormGroupDirective } from '@angular/forms';\nimport { Store, getValue } from '@ngxs/store';\nimport { Subject } from 'rxjs';\nimport { takeUntil, debounceTime, first } from 'rxjs/operators';\nimport { UpdateFormStatus, UpdateFormValue, UpdateFormDirty, UpdateFormErrors, UpdateForm } from './actions';\n\n@Directive({ selector: '[ngxsForm]' })\nexport class FormDirective implements OnInit, OnDestroy {\n  @Input('ngxsForm') path: string;\n  @Input('ngxsFormDebounce') debounce = 100;\n  @Input('ngxsFormClearOnDestroy') clearDestroy: boolean;\n\n  private _destroy$ = new Subject<null>();\n  private _updating = false;\n\n  constructor(private _store: Store, private _formGroupDirective: FormGroupDirective, private _cd: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    this._store\n      .select(state => getValue(state, `${this.path}.model`))\n      .pipe(takeUntil(this._destroy$))\n      .subscribe(model => {\n        if (!this._updating && model) {\n          this._formGroupDirective.form.patchValue(model);\n          this._cd.markForCheck();\n        }\n      });\n\n    // On first state change, sync form model, status and dirty with state\n    this._store\n      .select(state => getValue(state, `${this.path}`))\n      .pipe(takeUntil(this._destroy$), first())\n      .subscribe(state => {\n        this._store.dispatch([\n          new UpdateFormValue({\n            path: this.path,\n            value: this._formGroupDirective.form.getRawValue()\n          }),\n          new UpdateFormStatus({\n            path: this.path,\n            status: this._formGroupDirective.form.status\n          }),\n          new UpdateFormDirty({\n            path: this.path,\n            dirty: this._formGroupDirective.form.dirty\n          })\n        ]);\n      });\n\n    this._store\n      .select(state => getValue(state, `${this.path}.dirty`))\n      .pipe(takeUntil(this._destroy$))\n      .subscribe(dirty => {\n        if (this._formGroupDirective.form.dirty !== dirty) {\n          if (dirty === true) {\n            this._formGroupDirective.form.markAsDirty();\n            this._cd.markForCheck();\n          } else if (dirty === false) {\n            this._formGroupDirective.form.markAsPristine();\n            this._cd.markForCheck();\n          }\n        }\n      });\n\n    this._store\n      .select(state => getValue(state, `${this.path}.disabled`))\n      .pipe(takeUntil(this._destroy$))\n      .subscribe(disabled => {\n        if (this._formGroupDirective.form.disabled !== disabled) {\n          if (disabled === true) {\n            this._formGroupDirective.form.disable();\n            this._cd.markForCheck();\n          } else if (disabled === false) {\n            this._formGroupDirective.form.enable();\n            this._cd.markForCheck();\n          }\n        }\n      });\n\n    this._formGroupDirective.valueChanges.pipe(debounceTime(this.debounce), takeUntil(this._destroy$)).subscribe(() => {\n      const value = this._formGroupDirective.control.getRawValue();\n      this._updating = true;\n      this._store\n        .dispatch([\n          new UpdateFormValue({\n            path: this.path,\n            value\n          }),\n          new UpdateFormDirty({\n            path: this.path,\n            dirty: this._formGroupDirective.dirty\n          }),\n          new UpdateFormErrors({\n            path: this.path,\n            errors: this._formGroupDirective.errors\n          })\n        ])\n        .subscribe({\n          error: () => (this._updating = false),\n          complete: () => (this._updating = false)\n        });\n    });\n\n    this._formGroupDirective.statusChanges\n      .pipe(debounceTime(this.debounce), takeUntil(this._destroy$))\n      .subscribe((status: string) => {\n        this._store.dispatch(\n          new UpdateFormStatus({\n            status,\n            path: this.path\n          })\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this._destroy$.next();\n    this._destroy$.complete();\n\n    if (this.clearDestroy) {\n      this._store.dispatch(\n        new UpdateForm({\n          path: this.path,\n          value: null,\n          dirty: null,\n          status: null,\n          errors: null\n        })\n      );\n    }\n  }\n}\n"
  ],
  "names": [],
  "mappings": "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"
}
