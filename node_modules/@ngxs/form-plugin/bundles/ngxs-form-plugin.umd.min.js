!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngxs/store"),require("@angular/forms"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ngxs/form-plugin",["exports","@angular/core","@ngxs/store","@angular/forms","rxjs","rxjs/operators"],e):e((t.ngxs=t.ngxs||{},t.ngxs["form-plugin"]={}),t.ng.core,t["ngxs-store"],t.ng.forms,t.rxjs,t.Rx.Observable.prototype)}(this,function(t,e,i,r,o,a){"use strict";var s=function(t){this.payload=t};s.type="[Forms] Update Form Status";var n=function(t){this.payload=t};n.type="[Forms] Update Form Value";var p=function(t){this.payload=t};p.type="[Forms] Update Form";var u=function(t){this.payload=t};u.type="[Forms] Update Form Dirty";var c=function(t){this.payload=t};c.type="[Forms] Set Form Dirty";var d=function(t){this.payload=t};d.type="[Forms] Set Form Pristine";var l=function(t){this.payload=t};l.type="[Forms] Update Form Errors";var y=function(t){this.payload=t};y.type="[Forms] Set Form Disabled";var m=function(t){this.payload=t};m.type="[Forms] Set Form Enabled";var f=function(){function t(){}return t.prototype.handle=function(t,e,r){var o=i.getActionTypeFromInstance(e),a=t;return o!==n.type&&o!==p.type||(a=i.setValue(a,e.payload.path+".model",Object.assign({},e.payload.value))),o!==s.type&&o!==p.type||(a=i.setValue(a,e.payload.path+".status",e.payload.status)),o!==l.type&&o!==p.type||(a=i.setValue(a,e.payload.path+".errors",Object.assign({},e.payload.errors))),o!==u.type&&o!==p.type||(a=i.setValue(a,e.payload.path+".dirty",e.payload.dirty)),o===c.type&&(a=i.setValue(a,e.payload+".dirty",!0)),o===d.type&&(a=i.setValue(a,e.payload+".dirty",!1)),o===y.type&&(a=i.setValue(a,e.payload+".disabled",!0)),o===m.type&&(a=i.setValue(a,e.payload+".disabled",!1)),r(a,e)},t}();f.decorators=[{type:e.Injectable}],f.ctorParameters=function(){return[]};var h=function(){function t(t,e,r){this._store=t,this._formGroupDirective=e,this._cd=r,this.debounce=100,this._destroy$=new o.Subject,this._updating=!1}return t.prototype.ngOnInit=function(){var e=this;this._store.select(function(t){return i.getValue(t,e.path+".model")}).pipe(a.takeUntil(this._destroy$)).subscribe(function(t){!e._updating&&t&&(e._formGroupDirective.form.patchValue(t),e._cd.markForCheck())}),this._store.select(function(t){return i.getValue(t,""+e.path)}).pipe(a.takeUntil(this._destroy$),a.first()).subscribe(function(t){e._store.dispatch([new n({path:e.path,value:e._formGroupDirective.form.getRawValue()}),new s({path:e.path,status:e._formGroupDirective.form.status}),new u({path:e.path,dirty:e._formGroupDirective.form.dirty})])}),this._store.select(function(t){return i.getValue(t,e.path+".dirty")}).pipe(a.takeUntil(this._destroy$)).subscribe(function(t){e._formGroupDirective.form.dirty!==t&&(!0===t?(e._formGroupDirective.form.markAsDirty(),e._cd.markForCheck()):!1===t&&(e._formGroupDirective.form.markAsPristine(),e._cd.markForCheck()))}),this._store.select(function(t){return i.getValue(t,e.path+".disabled")}).pipe(a.takeUntil(this._destroy$)).subscribe(function(t){e._formGroupDirective.form.disabled!==t&&(!0===t?(e._formGroupDirective.form.disable(),e._cd.markForCheck()):!1===t&&(e._formGroupDirective.form.enable(),e._cd.markForCheck()))}),this._formGroupDirective.valueChanges.pipe(a.debounceTime(this.debounce),a.takeUntil(this._destroy$)).subscribe(function(){var t=e._formGroupDirective.control.getRawValue();e._updating=!0,e._store.dispatch([new n({path:e.path,value:t}),new u({path:e.path,dirty:e._formGroupDirective.dirty}),new l({path:e.path,errors:e._formGroupDirective.errors})]).subscribe({error:function(){return e._updating=!1},complete:function(){return e._updating=!1}})}),this._formGroupDirective.statusChanges.pipe(a.debounceTime(this.debounce),a.takeUntil(this._destroy$)).subscribe(function(t){e._store.dispatch(new s({status:t,path:e.path}))})},t.prototype.ngOnDestroy=function(){this._destroy$.next(),this._destroy$.complete(),this.clearDestroy&&this._store.dispatch(new p({path:this.path,value:null,dirty:null,status:null,errors:null}))},t}();h.decorators=[{type:e.Directive,args:[{selector:"[ngxsForm]"}]}],h.ctorParameters=function(){return[{type:i.Store},{type:r.FormGroupDirective},{type:e.ChangeDetectorRef}]},h.propDecorators={path:[{type:e.Input,args:["ngxsForm"]}],debounce:[{type:e.Input,args:["ngxsFormDebounce"]}],clearDestroy:[{type:e.Input,args:["ngxsFormClearOnDestroy"]}]};var g=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:i.NGXS_PLUGINS,useClass:f,multi:!0}]}},t}();g.decorators=[{type:e.NgModule,args:[{imports:[r.ReactiveFormsModule],declarations:[h],exports:[h]}]}],t.Éµa=h,t.NgxsFormPluginModule=g,t.NgxsFormPlugin=f,t.UpdateFormStatus=s,t.UpdateFormValue=n,t.UpdateForm=p,t.UpdateFormDirty=u,t.SetFormDirty=c,t.SetFormPristine=d,t.UpdateFormErrors=l,t.SetFormDisabled=y,t.SetFormEnabled=m,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngxs-form-plugin.umd.min.js.map
